# Google Java 规范
原文 https://google.github.io/styleguide/javaguide.html
## 1 简介
本文提供完整的Google Java 代码规范，Google风格的Java代码必须严格遵循此文档。  
像其他代码规范一样，本规范包括代码美观和一些标准约定。但是，我们更关注一些确定的规则，避免给出一些不明确的建议（无论对于人还是工具）。
### 1.1 术语说明
在本文档中，除非特殊声明：
1. 术语 _类_ 包括，普通类，枚举类，接口和注解。
2. 术语 _成员_ 包括内部类，字段，方法，构造方法，即除注解以外的所有顶级内容。
3. 术语 _注释_ 通常是指实现的注解。我们一般不使用“文档注释”的说法而使用术语“Javadoc”  
其他文档说明会在文中需要的地方出现。

### 1.2 规范说明
文中示例代码是非规范的。也就是说，即使示例代码符合Google规范，但不代表这是Google唯一的规范。示例中的可选规范不应被当众强制规则。  

## 2 源文件基础
### 2.1 文件名
源文件名由源文件中区分大小写的顶级类名加`.java`后缀构成
### 2.2 编码格式：UTF-8
源文件采用UTF-8编码
### 2.3 特殊字符
#### 2.3.1 空格字符
除了行终止符外，在源文件中ASCII空格字符（0x20）是唯一可以再任何地方都可能出现的空格字符
这意味着：
1. 所有其他空格字符都是经过转义的。
2. 制表符不用于缩进。

#### 2.3.2 转义字符
对于任何有特殊意义的转义序列应当用(\b,\t,\n,\f,\r,\",\'和\\),而不是用八进制转义符(e.g.\012)或Unicode转义符(e.g.\u000a)
#### 2.3.3 非ASCII字符
对于非ASCII字符，采用Unicode字符(e.g.∞)或Unicode转义符(e.g.\u221e)。这取决于那种方式更易于理解，建议不要才有Unicode转义符，即使有注释。  
> 对于Unicode转义符，甚至是Unicode字符，注释会对其解释很有帮助。  

示例  

| Example | Discussion |
| :------------- | :------------- |
| String unitAbbrev = "μs"; | 最优解：清晰明了甚至不需要注释 |
| String unitAbbrev = "\u03bcs"; // "μs" | 允许：但是没必要这么做 |
| String unitAbbrev = "\u03bcs"; // 希腊字母mu，"s" | 允许：但是笨拙且易出错 |
| String unitAbbrev = "\u03bcs"; | 不建议：不易理解 |
| return '\ufeff' + content; // 字节顺序标记 | 良好：对于不会打印出的字符在需要的时候提供了注释 |

> 不要担心一些程序不能处理非ASCII字符而使得你的程序不可读，如果发生这种情况，程序将会被破坏，会有人修复的。  

## 3 源文件结构
源文件按顺序包括：
  1. 许可或版权信息（如果有的话）
  2. 包声明
  3. 导入声明
  4. 一个顶级类   

用一个空行分割每个部分。

### 3.1 许可或版权信息（如果有的话）
如果源文件中有许可或版权信息，那么它应当在这里（源文件头部）

### 3.2 包声明
包的声明是不换行的，每行的字数限制不包括包声明

### 3.3 导入声明
#### 3.3.1 不使用通配符
无论是否是静态，都不适用通配符导入引用
#### 3.3.2 不换行
导入声明是不换行的，每行的字数限制不包括导入声明
#### 3.3.3 顺序和间隔
导入遵循以下顺序：
1. 所有静态引用在单独的一块儿
2. 所有的非静态引用在单独的一块儿

如果既有静态又有非静态，有一个空行。导入声明中只有这一个空行。  
每个导入块儿中，都是按导入名字的ASCII顺序排序的。
#### 3.3.4 不引入静态类
静态导入不导入内部类，只导入普通类。

### 3.4 类声明
#### 3.4.1 只有一个顶级类
每一个顶级类都写在它的源文件中
#### 3.4.2 类中内容的顺序
类成员和初始化顺序会对代码的可读性造成影响.但是关于类成员排序的原则并没有一个统一的定论，不同的类肯能更适合不同的排序。  
每个类都用一些逻辑顺序在维护者给他人解释这个类时很重要。例如，新的方法不要按照习惯依照时间加到类的最后边，那不是逻辑顺序。
##### 3.4.2.1 重载：永远放在一起
当一个类有多个构造器或多个同名方法时，它们应该依次放在一起，中间没有其他代码，甚至是私有成员。

## 4 格式化
术语小贴士：块状构造是指类，方法或构造函数的主体。注意，根据第4.8.3.1节关于数组初始化程序的介绍，可以选择将任何数组初始化程序视为类似于块的构造。
### 4.1 大括号
#### 4.1.1 大括号用于可选的地方
大括号和if,else,for,do还有while语句一起使用，即使代码块儿为空或只有一行。
#### 4.1.2 非空块儿：K & R风格
在非空块儿和块状构造中，大括号准守Kernighan和Ritchie风格（“埃及风格”）：
* 左括号前不换行
* 左括号后换行
* 右括号前换行
* 仅在大括号终止语句或终止方法，构造函数或命名类的主体时，才在右括号后换行。例如，如果大括号后跟着else或逗号，则没有换行符。

例如：
``` Java
return () -> {
  while (condition()) {
    method();
  }
};

return new MyClass() {
  @Override public void method() {
    if (condition()) {
      try {
        something();
      } catch (ProblemException e) {
        recover();
      }
    } else if (otherCondition()) {
      somethingElse();
    } else {
      lastThing();
    }
  }
};
```
枚举类有一些例外情况，在4.8.1枚举

#### 4.1.3 空块儿：可以简介一些
一个空的块或构造块儿可以按K&R风格（就像4.1.2那样）也可以把左右括号紧挨着，中间没有字符或空行，除非这时多个块中的一部分（一个直观的例子就是代码块儿：if/else或try/catch/finally）。  
例如：
``` Java
// 这时被允许的
void doNothing() {}

// 这也是被允许的
void doNothingElse() {
}

// 这是不允许的：在多块儿代码中不是简洁代码
try {
  doSomething();
} catch (Exception e) {}
```
### 4.2 块儿缩进：两个空格
每个新块儿或块状构造中，都要缩进两个空格。当块结束时，缩进返回到原来的状态。缩进适用于代码和注释。（参见4.1.2，非空代码块儿：K&R风格）
### 4.3 每句代码占一行
每句代码后面跟一个换行符。
### 4.4 每行字数限制：100
Java代码限制每行最多100个字符。一个字符就是任意的一个Unicode单元，除非另有说明，任何超过限制的代码都应该换行，就像4.5换行解释的那样。
> 每个Unicode单位算一个字符，不管其展示如何。例如，在全角模式下，你可能比半角模式更早的换行。   

例外情况：
1. 不是每一行都必须遵守字数限制（例如，Javadoc中的长URL或长JSNI方法引用）
2. 包声明和导入声明（详见，3.2包声明和3.3导入声明）
3. 换行会导致不在注释区的注释

### 4.5 换行
术语小贴士：将一行代买划分为多行的行为，叫做换行。  
没有明确的，固定的方式解决所有情况下的换行。通常一行代码有几种不同的方式。  
> 小贴士：除了避免超过字数限制，作者也可以自己根据实际情况决定是否换行

> 提醒：提取方法或本地变量可以在不换行的情况下解决问题  

#### 4.5.1 在哪里换行
换行的基本原则是：在高级语法上换行。即：
1. 在非运算符处换行，折行发生在符号前面。（注意这条原则与其他语言的Google风格不同，例如C++和JavaScript。）
  * 以下操作同样属于符号的范围：
    * 句号（.）
    * 方法引用中的两个冒号（::）
    * 类型绑定符中的&（<T扩展Foo＆Bar>）
    * catch块中的|（catch（FooException | BarException e））
2. 在赋值运算符处换行时，换行通常在符号之后，但是其他方式也可以接受
  * 这同时适用于类似的赋值运算符for循环中的冒号
3. 在方法或构造器名称后的左括号后（(）
4. 逗号始终放在前面的语句后面（逗号前不换行）
5. lambda表达式中的箭头不会被折断，但如果箭头如果是单行命令的话，箭头后悔折行  

``` Java
MyLambda<String, Long, Object> lambda =
    (String label, Long value, Object obj) -> {
        ...
    };

Predicate<String> predicate = str ->
    longExpressionInvolving(str);
```
> 小贴士：换行的主要目的是为了有一个更整洁的代码，不一定要追求更少的代码行数  

#### 4.5.2 缩进连续至少4个空格
当发生换行的时候，下一行必须必原来的一行缩进至少4个空格。  
当有多行换行时，缩进可以调整超过4个空格，通常，两条连续在且仅当它们在句法上平行行才使用相同的缩进级别。

## 4.6 空格
### 4.6.1 空行
空行总是出现在以下地方：
1. 在类中连续的成员或初始化器之间：字段，构造器，方法，内部类，静态初始化器，和实例初始化器。  
  * 例外情况：两个连续字段之间肯能会有空行。空行用来给逻辑分组。
  * 例外情况：枚举之间的空行参见4.8.1
2. 本文描述的其他情况（像第3节源文件结构和第3.3节导入声明）  

只要对可读性有帮助，都可以使用一个空行。比如一个代码块中的逻辑子块儿。不鼓励在类的第一个成员或初始化器之前或最后一个成员或构造器之后添加空行。  
运行有连续多个空行，但不鼓励这么做。
#### 4.6.2 横向空格
除了语言或其他样式规则的要求之外，除了文字，注释和Javadoc外，单个ASCII空间也仅出现在以下位置：
1. 将保留字例如`if`,`for`或`catch`与后面的左括号（`(`）分开。
2. 将保留字例如`else`或`catch`与前面的右括号（`}`）分开
3. 在所有左括号前（`{`），有两个例外：
  * `SomeAnnotation({a, b})` (不需要空格)
  * `String[][] x = {{"foo"}};`(早`{{`之间不需要空格，参见第8条)
4. 在所有的二元或三元操作符两边，这条规则同样适用于以下情况：
  * 类型绑定的连字符中：`<T extend Foo & Bar>`
  * catch块中的用于区分不同异常的竖线：`catch (FooException | BarException e)`
  * `for`循环中的冒号（`:`）
  * lambda表达式中的箭头：`(String str) -> str.length()`  
  
  例外情况：
  * 表示方法引用的两个冒号之间`::`，例如：`Object::toString`
  * 分割点（`.`）,例如：`object.toString()`
5. 在`,:;`或者表示强制转型的（`)`）之后
6. 在句尾注释`//`两边，这里允许有多个空格，但不强制
7. 在声明类型和变量之间，例如：`List<String> list`
8. 在数组初始化的时候两个括号的里边允许添加括号
  * `new int[] {5, 6}` 和 `new int[] { 5, 6 }`都是合法的。
9. 在类型声明和`[]`或`...`。

此规则并不要求或静止在一行的开头或结尾添加空格；此规则仅处理一行之间的空格

#### 4.6.3 水平对齐：不需要
属于小贴士：水平对齐是通过添加若干空格，使上下几行的代码对齐。  
在Google风格中这种做法是允许的，但是不是必要的。甚至不需要在已经使用过的地方保持水平对齐。  
下面有一个没对齐的例子和一个对齐的例子：
``` Java
  private int x; // 这时规范的
  private Color color; // 这也是规范的

  private int   x;      // 允许，但以后可以被改写
  private Color color;  // 可能会使其不对齐
```
> 提示：对齐的目标是可读性，但会给未来的维护带来问题。考虑到未来的改动将会涉及到这一行
